{% extends 'base.html' %}

{% block title %}Запросы на посты - Social Network{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2><i class="bi bi-inbox me-2"></i>Запросы на доступ к постам</h2>
        <p class="text-muted mb-4">Пользователи запрашивают доступ к вашим постам "по запросу"</p>
        
        {% if requests %}
            {% for request in requests %}
                <div class="card mb-3 shadow-sm">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                <img src="{{ request.requester.profile.get_avatar }}" alt="{{ request.requester.username }}" 
                                     class="rounded-circle" width="60" height="60">
                            </div>
                            <div class="col-md-6">
                                <h6 class="mb-1">
                                    <a href="{% url 'user_profile' request.requester.username %}" class="text-decoration-none">
                                        {{ request.requester.get_full_name|default:request.requester.username }}
                                    </a>
                                </h6>
                                <p class="text-muted mb-1">@{{ request.requester.username }}</p>
                                <small class="text-muted">Запрашивает доступ к посту:</small>
                                <p class="mb-0">
                                    <a href="{% url 'post_detail' request.post.pk %}" class="text-decoration-none">
                                        "{{ request.post.title }}"
                                    </a>
                                </p>
                                <small class="text-muted">{{ request.created_at|timesince }} назад</small>
                            </div>
                            <div class="col-md-4 text-end">
                                {% if not request.approved %}
                                    <a href="{% url 'approve_request' request.pk %}" class="btn btn-success btn-sm me-2">
                                        <i class="bi bi-check-circle me-1"></i>Одобрить
                                    </a>
                                    <a href="{% url 'deny_request' request.pk %}" class="btn btn-danger btn-sm"
                                       onclick="return confirm('Отклонить запрос?')">
                                        <i class="bi bi-x-circle me-1"></i>Отклонить
                                    </a>
                                {% else %}
                                    <span class="badge bg-success">
                                        <i class="bi bi-check-circle me-1"></i>Одобрено
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="text-center py-5">
                <i class="bi bi-inbox display-1 text-muted"></i>
                <h3 class="mt-3">Запросов пока нет</h3>
                <p class="text-muted">Когда пользователи будут запрашивать доступ к вашим постам "по запросу", они появятся здесь.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}